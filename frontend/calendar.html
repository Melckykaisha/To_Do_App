<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendar - FocusFlow</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="calendar-page">
  <!-- Top Bar -->
  <div class="topbar">
    <button class="toggle-btn">‚ò∞</button>
    <h1>Calendar üóìÔ∏è</h1>
  </div>

  <!-- Overlay (for mobile) -->
  <div class="overlay"></div>

  <div class="page-content">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2 class="logo">FocusFlow</h2>
      <ul>
        <li><a href="homepage.html">üè† Homepage</a></li>
        <li><a href="today.html">üìå Today</a></li>
        <li><a href="upcoming.html">üöÄ Upcoming</a></li>
        <li><a href="calendar.html" class="active">üóìÔ∏è Calendar</a></li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="calendar-container">
        <div class="calendar-header">
          <button id="prevMonth">‚¨Ö</button>
          <h2 id="monthYear"></h2>
          <button id="nextMonth">‚û°</button>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
      </div>
    </div>
  </div>

  <!-- Task Modal -->
  <div id="taskModal" class="modal hidden">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <h3 id="modalDate"></h3>
      <ul id="taskList"></ul>
    </div>
  </div>

  <script>
    const API_URL = "http://localhost:3000/tasks";
    let currentDate = new Date();

    const monthYear = document.getElementById("monthYear");
    const calendarGrid = document.getElementById("calendarGrid");
    const taskModal = document.getElementById("taskModal");
    const modalDate = document.getElementById("modalDate");
    const taskList = document.getElementById("taskList");
    const closeModal = document.getElementById("closeModal");

    // Fetch tasks
    async function fetchTasks() {
      const res = await fetch(API_URL);
      return await res.json();
    }

    // Render calendar
    async function renderCalendar() {
      const tasks = await fetchTasks();
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();

      monthYear.textContent = currentDate.toLocaleDateString("en-US", {
        month: "long",
        year: "numeric",
      });

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      calendarGrid.innerHTML = "";

      // Empty cells before start
      for (let i = 0; i < firstDay; i++) {
        const empty = document.createElement("div");
        calendarGrid.appendChild(empty);
      }

      // Fill days
      for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement("div");
        dayCell.classList.add("calendar-day");

        if (
          day === new Date().getDate() &&
          month === new Date().getMonth() &&
          year === new Date().getFullYear()
        ) {
          dayCell.classList.add("today");
        }

        const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
        const dayTasks = tasks.filter((t) => t.dueDate === dateStr);

        dayCell.innerHTML = `<strong>${day}</strong>`;

        // Task badges
        dayTasks.forEach((task) => {
          const span = document.createElement("span");
          span.classList.add("task-badge", task.priority ? `task-${task.priority}` : "task-low");
          span.textContent = task.title;
          dayCell.appendChild(span);
        });

        // Click to open modal
        dayCell.addEventListener("click", () => {
          modalDate.textContent = `Tasks on ${dateStr}`;
          taskList.innerHTML = "";
          if (dayTasks.length === 0) {
            taskList.innerHTML = "<li>No tasks</li>";
          } else {
            dayTasks.forEach((task) => {
              const li = document.createElement("li");
              li.textContent = `${task.title} (${task.priority || "low"})`;
              taskList.appendChild(li);
            });
          }
          taskModal.classList.remove("hidden");
        });

        calendarGrid.appendChild(dayCell);
      }
    }

    // Navigation
    document.getElementById("prevMonth").addEventListener("click", () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    });
    document.getElementById("nextMonth").addEventListener("click", () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    });

    // Close modal
    closeModal.addEventListener("click", () => {
      taskModal.classList.add("hidden");
    });

    // Sidebar toggle
    const toggleBtn = document.querySelector(".toggle-btn");
    const sidebar = document.querySelector(".sidebar");
    const overlay = document.querySelector(".overlay");

    toggleBtn.addEventListener("click", () => {
      sidebar.classList.toggle("open");
      overlay.classList.toggle("show");
    });

    overlay.addEventListener("click", () => {
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
    });

    // Load calendar
    renderCalendar();
  </script>
</body>

</html>